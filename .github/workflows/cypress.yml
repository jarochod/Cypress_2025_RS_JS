name: Cypress E2E Tests

on:
  push:
    branches: [main]
  workflow_dispatch:

jobs:
  cypress:
    runs-on: ubuntu-latest
    
    steps:
    - name: â¬‡ï¸ Checkout code
      uses: actions/checkout@v4
      
    - name: ğŸ”¨ Build and Run Cypress Tests with Docker Compose
      run: |
        # Tworzenie tymczasowego pliku .env na potrzeby akcji. 
        # ZastÄ…p poniÅ¼szy wiersz odpowiednimi zmiennymi Å›rodowiskowymi, 
        # ktÃ³re sÄ… potrzebne przez TwojÄ… aplikacjÄ™/testy, np.
        # echo "API_URL=http://localhost:8080" > .env
        echo "BASE_URL=http://localhost:2221/" > .env
        echo "ADMIN_USERNAME=admin" >> .env
        echo "ADMIN_PASSWORD=${{ secrets.ADMIN_PASSWORD }}" >> .env
        
        # Uruchomienie serwisu 'cypress-tests' z docker-compose.
        # Flaga --exit-code-from zapewni, Å¼e kod wyjÅ›cia (status) testÃ³w zostanie 
        # uÅ¼yty jako kod wyjÅ›cia caÅ‚ego polecenia, co jest kluczowe dla statusu joba.
        # Flaga --build zbuduje obraz, jeÅ›li jest nieaktualny lub nie istnieje.
        docker-compose up --build --exit-code-from cypress-tests cypress-tests
      
    - name: ğŸ’¾ Upload Test Artifacts (Screenshots & Videos)
      uses: actions/upload-artifact@v4
      if: always() # Uruchom zawsze, nawet jeÅ›li testy siÄ™ nie powiodÅ‚y, aby zachowaÄ‡ artefakty
      with:
        name: cypress-artifacts-${{ github.sha }}
        path: |
          cypress/videos
          cypress/screenshots

